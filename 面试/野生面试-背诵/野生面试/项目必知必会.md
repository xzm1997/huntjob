



# è¯¾ç¨‹ä»‹ç»

æ­£å¤„äºæ˜¥æ‹›çš„é»„é‡‘æ—¶æœŸï¼Œä¸ºäº†å¸®åŠ©å¤§å®¶æ‰¾åˆ°æ›´å¥½çš„å·¥ä½œï¼Œæ›´å¿«çš„æ‰¾åˆ°å·¥ä½œã€‚ç»„ç»‡æœ¬æ¬¡çš„ä¸“é¡¹è¯¾ç¨‹ã€‚

ä»Šæ—¥çš„è¯¾ç¨‹ä¸»é¢˜æ˜¯ **é¡¹ç›®**ï¼Œä¼šè®²åˆ°å…¬å¸é¡¹ç›®ç ”å‘çš„æµç¨‹ã€‚

å› ä¸ºé¡¹ç›®ä¸€èˆ¬**ä¸æ˜¯**é¢è¯•æ—¶å€™çš„æ ¸å¿ƒè€ƒå¯Ÿç‚¹ï¼Œæ‰€ä»¥ä»Šå¤©è¿˜ä¼šè®²åˆ°ä¸€äº›é¡¹ç›®ä¸­**ç»å…¸é—®é¢˜åŠè§£æ³•**ã€‚

å› ä¸º**æ—¶é—´æœ‰é™**, è€å¸ˆè¿™é‡Œå‡†å¤‡çš„éƒ½æ˜¯é¢è¯•ä¸­**æœ€å¸¸è§çš„é—®é¢˜**,  

ä»¥**è®²ä¹‰**å†…å®¹ä¸ºä¸»,  å¦‚æœè®²è§£å®Œæ¯•åä»æœ‰æ—¶é—´, æˆ‘ä»¬å†ç»§ç»­æ‰©å±•å…¶ä»–



# å­¦ä¹ ç›®æ ‡

* [x] ç†è§£ promise ä¸»è¦è§£å†³çš„é—®é¢˜åŠå¸¸è§„ç”¨æ³•
* [x] èƒ½å¤Ÿå†™å‡ºä¸€ä¸ªå¯ä»¥è¢«é“¾å¼è°ƒç”¨çš„å‡½æ•°
* [x] èƒ½ç²—ç•¥çš„å®ç° promiseçš„åŸºæœ¬ç»“æ„
* [x] å¯ä»¥è‡ªå·±å°è£…ä¸€èˆ¬çš„ api è¯·æ±‚æ¨¡å—
* [x] äº†è§£å…¬å¸ä¸€èˆ¬çš„è§’è‰²ï¼ˆå²—ä½ï¼‰åŠèŒè´£
* [x] çŸ¥é“ä¸€ä¸ªå…¬å¸å¸¸è§„é¡¹ç›®çš„æµç¨‹
* [x] çŸ¥é“å…¬å¸å¸¸è§„çš„ç¼ºé™·ç®¡ç†çš„æµç¨‹
* [x] çŸ¥é“å¸¸è§„çš„ä»£ç ç®¡ç†æ–¹å¼
* [x] çŸ¥é“å¸¸è§„ç³»ç»Ÿçš„ç™»å½•éƒ¨åˆ†æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼ˆç®€å•ç™»å½•/å•ç‚¹ç™»å½•ï¼‰
* [x] çŸ¥é“ç³»ç»Ÿçš„æƒé™éƒ¨åˆ†å¦‚ä½•è®¾è®¡çš„
* [x] å¯ä»¥å°†æ•°ç»„ç»“æ„çš„æ•°æ®è½¬æˆæ ‘ç»“æ„çš„æ•°æ®
* [x] å¯ä»¥å°†æ ‘ç»“æ„çš„æ•°æ®è½¬æˆæ•°ç»„çš„ç»“æ„
* [x] çŸ¥é“å¦‚ä½•é™åˆ¶æ¥å£çš„è®¿é—®é¢‘ç‡ï¼Œ
* [x] å¯ä»¥å®ç°ç®€å•çš„ debounce 



# é—®é¢˜åˆ—è¡¨

| çŸ¥è¯†ç‚¹                              |
| ----------------------------------- |
| promiseçš„æºç å’Œå®é™…é¡¹ç›®ä½¿ç”¨         |
| å‰ç«¯åç«¯å…·ä½“çš„åˆä½œçš„æµç¨‹            |
| ä»ç ”å‘åˆ°ä¸Šçº¿çš„å…·ä½“è¯¦è§£              |
| é¡¹ç›®å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜                |
| å¯¹axioså†æ¬¡å°è£…ï¼ˆç½‘ç»œè¯·æ±‚æ¨¡å—å°è£…ï¼‰ |
| æ··åˆAPPåŸç”ŸAPPæ‰“åŒ…ä¸Šçº¿              |
| é™åˆ¶æ¥å£è°ƒç”¨é¢‘ç‡                    |
| æƒé™ç®¡ç†ç»“åˆé¡¹ç›®å‰ç«¯å®ç°            |
| æ‰“åŒ…åˆ°é¡¹ç›®éƒ¨ç½²                      |
| å®ç°ç™»å½•                            |
| ç®¡ç†é¡¹ç›®                            |
| å¤„ç†æ ‘å½¢ç»“æ„                        |



# é¢è¯•é¢˜è¯¦è§£

## ç†è§£promise

**ã€é—®é¢˜åˆ†æã€‘**

æ€ä¹ˆç†è§£ promise ï¼Ÿ å†™å‡ºæŒ‡å®šä»£ç çš„è¾“å‡ºå†…å®¹ï¼Ÿ



**ã€ç­”é¢˜æ€è·¯ã€‘**

å…³äº promise é€šå¸¸ä¼šæœ‰ä¸‰ç§é¢˜å‹ã€‚ç¬¬ä¸€ç§å°±æ˜¯é—®æ¦‚å¿µï¼›ç¬¬äºŒç§å°±æ˜¯ ç»™ä¸€æ®µä»£ç è®©è¯´å‡ºä»–çš„è¾“å‡ºï¼›ç¬¬ä¸‰ç§ å°±æ˜¯è®©ä½ è‡ªå·±å®ç°ä¸€ä¸ª promise ï¼Œæ¥è€ƒå¯Ÿä½ å¯¹ promise çš„ç†è§£å’Œç¼–ç¨‹èƒ½åŠ›ã€‚ï¼ˆç¬¬ä¸‰ç§ä¸€èˆ¬æ˜¯é’ˆå¯¹ä¸­é«˜çº§çš„ç¨‹åºå‘˜ï¼‰

æœ¬èŠ‚æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ promiseçš„æ¦‚å¿µï¼Œç„¶åä¸€èµ·æ¥åšä¸¤ä¸ªé¢˜ã€‚

1. promise æ¦‚å¿µ

**promise å®šä¹‰**A promise is an object that may produce a single value some time in the future: either a resolved value, or a reason that itâ€™s not resolved (e.g., a network error occurred)

https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-promise-27fc71e77261

https://promisesaplus.com/implementations



2. promise é¢˜ç›®1

```js
æ•°å­—æ‰“å°çš„é¡ºåº  
const first = () => (new Promise((resolve, reject) => {
    console.log(3);
    let p = new Promise((resolve, reject) => {
        console.log(7);
        setTimeout(() => {
            console.log(5);
            resolve(6);
        }, 0)
        resolve(1);
    });
    resolve(2);
    p.then((arg) => {
        console.log(arg);
    });
 
}));
 
first().then((arg) => {
    console.log(arg);
});
console.log(4);


//1.åŒæ­¥çš„ä»£ç ï¼ˆæœ€é«˜ï¼‰
//3
//7
//4

//2. å¾®ä»»åŠ¡çš„å¼‚æ­¥ä»£ç ï¼ˆæ¬¡é«˜ï¼Œthenï¼‰

//1
//2


//3. å®ä»»åŠ¡çš„å¼‚æ­¥ä»£ç ï¼ˆæœ€ä½ï¼ŒsetTimeoutï¼‰
//5

//6 ä¸æ‰§è¡Œ
```



3. promise é¢˜ç›®2ï¼ˆç†è§£ then çš„ç¬¬äºŒå›è°ƒå‡½æ•°å’Œ catchï¼‰

```js
// ç”»å‡ºä»¥ä¸‹å¼‚æ­¥å‡½æ•°æ‰§è¡Œçš„å¯èƒ½çš„è·¯çº¿ã€‚
// https://developers.google.com/web/fundamentals/primers/promises
// è“çº¿è¡¨ç¤ºæ‰§è¡Œçš„ promise è·¯å¾„ï¼Œçº¢è·¯è¡¨ç¤ºæ‹’ç»çš„ promise è·¯å¾„ã€‚
// https://developers.google.com/web/fundamentals/primers/imgs/promise-flow.svg
asyncThing1()
  .then(function() {
    return asyncThing2();
  })
  .then(function() {
    return asyncThing3();
  })
  .catch(function(err) {
    return asyncRecovery1();
  })
  .then(
    function() {
      return asyncThing4();
    },
    function(err) {
      return asyncRecovery2();
    }
  )
  .catch(function(err) {
    console.log("Don't worry about it");
  })
  .then(function() {
    console.log("All done!");
  });
```



![image-20200215153639230](https://tva1.sinaimg.cn/large/0082zybpgy1gbx4j86yaaj30oi0mdwn1.jpg)



## promise å®è·µ

**ã€é—®é¢˜åˆ†æã€‘**

å¦‚ä½•æŠŠå¤§è±¡ğŸ˜æ”¾åˆ°å†°ç®±é‡Œï¼Ÿ



**ã€ç­”é¢˜æ€è·¯ã€‘**

å¼€é—¨/è£…å¤§è±¡/å…³é—¨ éƒ½æ˜¯å¼‚æ­¥çš„æ“ä½œã€‚

é€šè¿‡æœ¬é¢˜åŠ å¼ºå¯¹ promise çš„ç†è§£ï¼Œç†è§£ promise è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯ä»€ä¹ˆã€‚

```js
/////////////////æ–¹æ³•1  callback//////////////////
//1. å‡†å¤‡å‡½æ•° openDoor putIn closeDoor done
//2. æ‰§è¡Œå‡½æ•°

console.time()

const openDoor=(cb)=>{
  setTimeout(cb,1000)
}
const putIn=(cb)=>{
  setTimeout(cb,3*1000)
}
const closeDoor=(cb)=>{
  setTimeout(cb,1000)
}
const done=()=>{
   console.timeEnd();
  console.log('done');
}


openDoor(()=> putIn(()=> closeDoor(done)  ));


//////
//const openDoor = cb => {
//   setTimeout(cb, 1000);
// };

// const promise = () => {
//   return new Promise((res, rej) => {
//     setTimeout(() => {
//       res();
//     }, 1000);
//   });
// };

/////////////////vs/////////////////////
/////////////////æ–¹æ³•1  promise//////////////////
//1. å‡†å¤‡promiseå‡½æ•° openDoor putIn closeDoor done
//2. æ‰§è¡Œå‡½æ•°

console.time()

const openDoor=()=>new Promise(res=>{
  setTimeout(res,1000)
})
const putIn=()=>new Promise(res=>{
  setTimeout(res,1000*3)
})
const closeDoor=()=>new Promise(res=>{
  setTimeout(res,1000)
})
const done=()=>new Promise(res=>{
      console.timeEnd();
  console.log('done2');
  res();
})


openDoor()
  .then(putIn)
  .then(closeDoor)
  .then(done)

```



## å¦‚ä½•å®ç°é“¾å¼è°ƒç”¨

**ã€é—®é¢˜åˆ†æã€‘**

ç±»ä¼¼ `b.then().then().then()` çš„é“¾å¼è°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ



**ã€ç­”é¢˜æ€è·¯ã€‘**

å› ä¸ºè¦ä¸æ–­çš„è°ƒç”¨ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯è¿”å›è‡ªå·±ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ª å’Œè‡ªå·±ç±»ä¼¼çš„ç»“æ„ã€‚

åç»­å®ç° Promise çš„æ—¶å€™ï¼Œä¼šç”¨å¾—ä¸Šï¼



é¢è¯•å°±å¿ƒé‡Œå¼ºå¤§ä¸€ç‚¹å°±è¡Œï¼›å‡ºç»™æˆ‘çš„é¢˜ é¢è¯•å®˜å¦‚æœä¸çŸ¥æå‰çŸ¥é“ç­”æ¡ˆä¹Ÿ  å¯èƒ½ç­”ä¸å‡ºæ¥

























```js
  
class Test1{

  then(){
    console.log(6666);
    return this;
  }
}

var a= new Test1();
a.then().then().then()

class Test2{
  then(){
    console.log(77777);
    return new Test2();
  }
}

var b= new Test2();
b.then().then().then()
```



## promise å•å…ƒæµ‹è¯•

1.å‡†å¤‡æµ‹è¯•æ¡†æ¶

 å‚è€ƒ[jest](https://jestjs.io/docs/en/getting-started) å®˜ç½‘

```shell
# 1.åˆå§‹åŒ–é¡¹ç›®
npm init

# 2.å®‰è£… jest
yarn add --dev jest
#npm install --save-dev jest

# 3. æ”¯æŒ es2015+ å’Œ ts
yarn add --dev babel-jest @babel/core @babel/preset-env @babel/preset-typescript @types/jest


# 4. æ·»åŠ  æ–‡ä»¶ babel.config.js
// babel.config.js
module.exports = {
  presets: [
    ['@babel/preset-env', {targets: {node: 'current'}}],
     '@babel/preset-typescript',
  ],
};

# 5.é…ç½®å‘½ä»¤
    "test": "jest",
    "test:watch": "jest --watchAll"
```



2.ä¸ºäº†æ£€æŸ¥ Promise å®ç°çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬æå‰å‡†å¤‡å¥½å•å…ƒæµ‹è¯•

```js
  
import MyPromise from "./index";

// 1
test("1.promise å‚æ•°å‡½æ•°ä¼šç«‹å³æ‰§è¡Œ", function() {
  var string;

  new MyPromise(function() {
    string = "foo";
  });

  expect(string).toBe("foo");

},500);


it("2. promise åœ¨ then çš„å›è°ƒå‡½æ•°ä¸­å¯ä»¥æ‹¿åˆ° resolve çš„æ•°æ®ã€‚", function(done) {
  var testString = "foo";

  var promise = new MyPromise(function(resolve) {
    setTimeout(function() {
      resolve(testString);
    }, 20);
  });

  promise.then(function(string) {
    expect(string).toBe(testString);
    done();
  });
},500);

// 3
it("promise å¯ä»¥æœ‰å¤šä¸ª thenï¼Œå¹¶ä¸”ä¼šä¾æ¬¡æ‰§è¡Œ", function(done) {
  var testString = "foo";

  var promise = new MyPromise(function(resolve) {
    setTimeout(function() {
      resolve(testString);
    }, 20);
  });

  promise.then(function(string) {
    expect(string).toBe(testString);
  });

  promise.then(function(string) {
    expect(string).toBe(testString);
    done();
  });
},500);


it("4.promise å¯ä»¥åµŒå¥—å¤šä¸ª thenï¼Œthençš„å›è°ƒä¸­å¯ä»¥è¿”å› promise ", function(done) {
  var testString = "foo";

  var promise = new MyPromise(function(resolve) {
    setTimeout(function() {
      resolve();
    }, 20);
  });

  promise
    .then(function() {
      return new MyPromise(function(resolve) {
        setTimeout(function() {
          resolve(testString);
        }, 20);
      });
    })
    .then(function(string) {
      expect(string).toBe(testString);
      done();
    });
},500);

// 5
it("5.promise å¯ä»¥åµŒå¥—å¤šä¸ª thenï¼Œthençš„å›è°ƒä¸­å¯ä»¥è¿”å› ä¸€ä¸ªæ™®é€šå€¼", function(done) {
  var testString = "foo";

  var promise = new MyPromise(function(resolve) {
    setTimeout(function() {
      resolve();
    }, 20);
  });

  promise
    .then(function() {
      return testString;
    })
    .then(function(string) {
      expect(string).toBe(testString);
      done();
    });
},500);

// 6
it("6.resolved çŠ¶æ€çš„promise ï¼Œå¦‚æœè°ƒç”¨ then æ–¹æ³•ä¼šç«‹å³æ‰§è¡Œ", function(done) {
  var testString = "foo";

  var promise = new MyPromise(function(resolve) {
    setTimeout(function() {
      resolve(testString);
    }, 20);
  });

  setTimeout(function() {
    promise.then(function(value) {
      expect(value).toBe(testString);
      done();
    });
  }, 200);

},500);


it("7. äºŒæ¬¡è°ƒç”¨ resolve ä¸ä¼šäº§ç”Ÿå½±å“ã€‚", function(done) {
  var testString = "foo";
  var testString2 = "bar";

  var promise = new MyPromise(function(resolve) {
    setTimeout(function() {
      resolve(testString);
      resolve(testString2);
    }, 20);
  });

  promise.then(function(value) {
    expect(value).toBe(testString);
  });

  setTimeout(function() {
    promise.then(function(value) {
      expect(value).toBe(testString);
      done();
    });
  }, 50);

},500);
```



## promise æºç 

**ã€é—®é¢˜åˆ†æã€‘**

å¦‚ä½•å®ç°ä¸€ä¸ª Promise ï¼Ÿ



**ã€ç­”é¢˜æ€è·¯ã€‘**

promise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ new Promise ï¼ˆï¼‰æ¥å®ä¾‹åŒ–çš„ï¼›æ‰€ä»¥è¿™é‡Œæˆ‘è¦å®ç° Promise ç±»ï¼

promise çš„ then æ˜¯å¯ä»¥é“¾å¼è°ƒç”¨çš„ï¼Œæ‰€ä»¥å¯èƒ½ä¼šç”¨åˆ°ä¸Šé¢æåˆ°çš„ï¼Œé“¾å¼è°ƒç”¨çš„å®ç°ã€‚

æ ¹æ®é€ä¸ªå•å…ƒæµ‹è¯•çš„è¦æ±‚æ¥å®ç° Promise

ä¸»è¦å®ç° Promise çš„æ„é€ æ–¹æ³•å’Œ then æ–¹æ³•ï¼› åé¢ä¼šä»¥é“¾æ¥çš„æ–¹å¼ç»™å‡ºå®Œæ•´çš„å®ç°ã€‚

**ã€è§£é¢˜ä»£ç ã€‘**





```ts
const State = {
  pending: "pending",
  resolved: "rejected",
  rejected: "rejected"
};

const noop = () => {};

class MyPromise {
  constructor(exclutor) {
    exclutor(this._resolve.bind(this), this._reject);
  }
  _state = State.pending;
  _value;
  _resolve(val) {
    if (this._state === State.pending) {
      this._value = val;
      this._state = State.resolved;

      this._runResolveArray();
    }
  }
  _reject() {}
  _runResolveArray() {
    //æ‰§è¡Œ then ä¼ å…¥è¿›æ¥çš„ onRes
    this._resArray.forEach(item => {
      // const item
      const result = item.handle(this._value);
      const nextPromise = item.promise;

      if (result instanceof MyPromise) {
        result.then(val => item.promise._resolve(val));
      } else {
        item.promise._resolve(result);
      }
    });
  }

  _resArray = [];

  then(onRes, onRej = noop) {
    // if (this._state === State.pending) {
    const newPromise = new MyPromise(() => {});
    const item = { promise: newPromise, handle: onRes };
    this._resArray.push(item);

    // }
    if (this._state === State.resolved) {
      this._runResolveArray();
    }
    return newPromise;
  }
}

export default MyPromise;


```



ã€é—®é¢˜å»¶ä¼¸ã€‘

å‡ ç§Promise çš„å®ç°

https://github.com/ericyang89/my-promise

https://github.com/vividbytes/implementing-promises

https://github.com/iam91/zpromise/blob/master/src/zpromise.js



## é¡¹ç›®api è¯·æ±‚æ¨¡å—å°è£…

**ã€é¢˜ç›®åˆ†æã€‘**

ä½ é¡¹ç›®ä¸­çš„ç½‘ç»œ/api è¯·æ±‚æ¨¡å—æ˜¯å¦‚ä½•å°è£…çš„ï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

1. æ¥å£è¯·æ±‚ä¸€èˆ¬æ˜¯å¼‚æ­¥çš„ï¼Œå¯ä»¥è¿”å› promise æ›´åŠ æ¸…æ™°ã€‚
2. ç½‘ç»œè¯·æ±‚url çš„å…¬å…±éƒ¨åˆ†å¯ä»¥å•ç‹¬é…ç½®åˆ° ç½‘ç»œè¯·æ±‚å†…éƒ¨ã€‚
3. é’ˆå¯¹æ‰€æœ‰çš„æ¥å£å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ã€‚è¿™ä¹Ÿæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹çš„ä¸€ä¸ªå®è·µã€‚
4. å¯ä»¥å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ axios å¿«é€Ÿçš„å°è£… ç½‘ç»œè¯·æ±‚æ¨¡å—ã€‚

**ã€è§£é¢˜æ­¥éª¤ï½œä»£ç ã€‘**

```ts
import axios from "axios";
import constant from "../constant";
import reactNavigationHelper from "./reactNavigationHelper";
import commonToast from "./commonToast";

//é…ç½®è¯·æ±‚url çš„å…¬å…±éƒ¨åˆ†åŠè¶…æ—¶æ—¶é—´
const commonHttp = axios.create({
  baseURL: constant.baseUri,
  timeout: 10 * 1000
});

commonHttp.interceptors.response.use(
  function(response) {
    return response;
  },
  function(error) {
    //é’ˆå¯¹æ‰€æœ‰æ¥å£ç»Ÿä¸€å¤„ç†ç™»å½•è¿‡æœŸçš„é—®é¢˜
    if (error.response.status === 401) {
      commonToast.show("ç™»å½•è¿‡æœŸ");
      reactNavigationHelper.navigate("Login");
    }
    return Promise.reject(error);
  }
);

export default commonHttp;
```



## å…¬å¸è§’è‰²åŠèŒè´£

ä¸€èˆ¬å…¬å¸ä¸é¡¹ç›®æµç¨‹æœ‰å…³çš„è§’è‰²

![image-20200219142325265](https://tva1.sinaimg.cn/large/0082zybpgy1gc1ow4ov3nj30jy0hhn0u.jpg)

![image-20200219142343405](https://tva1.sinaimg.cn/large/0082zybpgy1gc1owg6le3j30jo0heq6o.jpg)

##é¡¹ç›®æµç¨‹

**ã€é¢˜ç›®åˆ†æã€‘**

ä½ ä»¬çš„å¼€å‘æµç¨‹/é¡¹ç›®æµç¨‹å¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

![image-20200219142531400](https://tva1.sinaimg.cn/large/0082zybpgy1gc1oybv0y5j30u00wbn9k.jpg)



![image-20200219142820684](https://tva1.sinaimg.cn/large/0082zybpgy1gc1p19c4iej30vc0rugvg.jpg?1)

![image-20200219142841929](https://tva1.sinaimg.cn/large/0082zybpgy1gc1p1mqu2dj30vd0b3juh.jpg)



![image-20200219150052792](https://tva1.sinaimg.cn/large/0082zybpgy1gc1pz3xe5hj30pm0tuq7t.jpg)



ç®€è¦è¯´æ˜é¡¹ç›®æµç¨‹ï¼š

1. äº§å“å‡ºéœ€æ±‚æ–‡æ¡£ï¼›å¼€éœ€æ±‚ä¼šï¼›
2. ä¼°æ—¶ï¼Œéƒ¨åˆ†é¡¹ç›®å†™æŠ€æœ¯æ–¹æ¡ˆï¼›æ¥å£é˜…è¯»
3. å¼€å§‹å¼€å‘ï¼›æµ‹è¯•ç»™å†’çƒŸæµ‹è¯•/æµ‹è¯•ç”¨ä¾‹è¯„å®¡
4. å‰åç«¯è”è°ƒ
5. å†’çƒŸæµ‹è¯•
6. ææµ‹
7. è·Ÿæµ‹/ä¸Šç¯å¢ƒ
8. ä¸Šçº¿/çº¿ä¸Šè·Ÿè¸ª/é¡¹ç›®æ€»ç»“



## é¡¹ç›®ç¼ºé™·ç®¡ç†

**ã€é¢˜ç›®åˆ†æã€‘**

å¦‚ä½•åšbug/ç¼ºé™·ç®¡ç†ï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

1. ç¼ºé™·ç®¡ç†è§’è‰²

   ![image-20200219144941335](https://tva1.sinaimg.cn/large/0082zybpgy1gc1pngtxqej30to0neadm.jpg)

   ![image-20200219145001216](https://tva1.sinaimg.cn/large/0082zybpgy1gc1pnsvg2ej30tl06dt9o.jpg)

2. bug å¤„ç†æµç¨‹

![image-20200219144601063](https://tva1.sinaimg.cn/large/0082zybpgy1gc1pjnhgvgj31930u0qjw.jpg)

![image-20200219144725016](https://tva1.sinaimg.cn/large/0082zybpgy1gc1pl3odp7j30y00s4wng.jpg)

## ä»£ç ç®¡ç†

**ã€é¢˜ç›®åˆ†æã€‘**

ä½ ä»¬çš„ä»£ç å¤§æ¦‚æ€ä¹ˆç®¡ç†çš„ï¼Ÿ

æ€ä¹ˆç®¡ç† git åˆ†æ”¯çš„ï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

![image-20200219150915511](https://tva1.sinaimg.cn/large/0082zybpgy1gc1q7u7w0sj317r0smh0y.jpg)

## é¡¹ç›®æ‰“åŒ…

**ã€é¢˜ç›®åˆ†æã€‘**

ä½ ä»¬é¡¹ç›®ä¸ºä»€ä¹ˆéœ€è¦æ‰“åŒ…/ç¼–è¯‘/æ„å»ºï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

ä¸ºä»€ä¹ˆè¦é¡¹ç›®æ‰“åŒ…ï¼Ÿ

1. es2015+ è½¬ es5

2. Js/css/å›¾ç‰‡ æ–‡ä»¶åˆå¹¶

3. ts è½¬ js

4. æ¨¡æ¿ç¼–è¯‘ jsx è½¬ js

5. less/sass è½¬ css

6. css 

7. ä»£ç å‹ç¼©

8. é’ˆå¯¹ä¸åŒç¯å¢ƒç”Ÿæˆä¸åŒçš„ä»£ç 

   

## å¸¸è§„ç™»å½•æµç¨‹

**ã€é¢˜ç›®åˆ†æã€‘**

ä½ ä»¬é¡¹ç›®ä¸­ç™»å½•å¤§æ¦‚æ˜¯æ€ä¹ˆå®ç°ï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

1. æœ€ç®€å•çš„ç™»å½•æµç¨‹

   ![image-20200219204350033](https://tva1.sinaimg.cn/large/0082zybpgy1gc1zvzkgwxj30m50b676h.jpg)

2. ç«¯ç‚¹ç™»å½•-sso

   ![image-20200219210517079](https://tva1.sinaimg.cn/large/0082zybpgy1gc20ibpe75j30kv0q3juv.jpg)

3. æ³¨æ„é—®é¢˜

   1. å¯†ç ä¸€èˆ¬ä¸ç”¨æ˜æ–‡ä¿å­˜
   2. å‘é€ ç”¨æˆ·å å¯†ç  çš„ç½‘ç»œè¯·æ±‚ä¸€èˆ¬ä¸ç”¨ get



## é¡¹ç›®ä¸­æƒé™ç®¡ç†

**ã€é¢˜ç›®åˆ†æã€‘**

ä½ ä»¬é¡¹ç›®ä¸­æƒé™ç®¡ç†æ˜¯æ€ä¹ˆå®ç°ï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

1. å¸¸è§„æƒé™æ¨¡å‹

   RBACåŸºäºè§’è‰²çš„æƒé™è®¿é—®æ§åˆ¶ï¼ˆRole-Based Access Controlï¼‰

   ![image-20200220112421950](https://tva1.sinaimg.cn/large/0082zybpgy1gc2pc8el7wj30jg0bhjv8.jpg)

   ![image-20200220112449243](https://tva1.sinaimg.cn/large/0082zybpgy1gc2pcqn4y5j30ji0algqp.jpg?)

2. å¸¸è§„ç®¡ç†ç³»ç»Ÿä¸­çš„æƒé™

   + æ ¹æ®ç™»å½•ç”¨æˆ·è¿”å›èœå•åˆ—è¡¨â€” â€” å¯èƒ½æ˜¯ä¸€é¢—æ ‘
   + æ ¹æ®ç™»å½•ç”¨æˆ·æ§åˆ¶æ¥å£æƒé™

3. å‰å°ç³»ç»Ÿä¸­çš„æƒé™ç®¡ç†

   + æ›´ä¸“æ³¨äºå…¥å£çš„æ§åˆ¶
   + è¶Šæƒçš„æç¤ºä¹Ÿä¸å¯å°‘
   + å¤šçº§æƒé™å¯èƒ½ä¼šæ¶‰åŠåˆ°è®¡ç®—



**ã€é—®é¢˜å»¶ä¼¸ã€‘**

èœå•åˆ—è¡¨é€šå¸¸æ˜¯ä¸€ä¸ªæ ‘çš„ç»“æ„ï¼Œåç«¯ä¸€èˆ¬å–œæ¬¢ç»™ä¸€ä¸ªåˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰ï¼Œè¯¥å¦‚ä½•å»æ„å»ºï¼Ÿï¼



## æ ¹æ®æ•°ç»„æ„å»ºæ ‘

**ã€é¢˜ç›®åˆ†æã€‘**

æ ¹æ®æ•°ç»„æ„å»ºæ ‘?

**ã€ç­”é¢˜æ€è·¯ã€‘**

1. ç»™å®šåŸå§‹æ•°æ®ï¼ˆoriginDataï¼‰ï¼ŒæœŸå¾…ç”Ÿæˆä¸€ä¸ªæ ‘å½¢ç»“æ„çš„å¯¹è±¡(treeData)ã€‚

```ts
  export type Item = {
  id: number;
  parentId: number;
  name: String;
};
export type Node = Item & { children: Node[] };
export const originData: Item[] = [
  {
    id: 0,
    parentId: null,
    name: "ç”Ÿç‰©"
  },
  {
    id: 1,
    parentId: 0,
    name: "åŠ¨ç‰©"
  },
  {
    id: 2,
    parentId: 0,
    name: "æ¤ç‰©"
  },
  {
    id: 3,
    parentId: 0,
    name: "å¾®ç”Ÿç‰©"
  },
  {
    id: 4,
    parentId: 1,
    name: "å“ºä¹³åŠ¨ç‰©"
  },
  {
    id: 5,
    parentId: 1,
    name: "åµç”ŸåŠ¨ç‰©"
  },
  {
    id: 6,
    parentId: 2,
    name: "ç§å­æ¤ç‰©"
  },
  {
    id: 7,
    parentId: 2,
    name: "è•¨ç±»æ¤ç‰©"
  },
  {
    id: 8,
    parentId: 4,
    name: "å¤§è±¡"
  },
  {
    id: 9,
    parentId: 4,
    name: "æµ·è±š"
  },
  {
    id: 10,
    parentId: 4,
    name: "çŒ©çŒ©"
  },
  {
    id: 11,
    parentId: 5,
    name: "èŸ’è›‡"
  },
  {
    id: 12,
    parentId: 5,
    name: "éº»é›€"
  }
];

export const treeData: Node = {
  children: [
    {
      children: [
        {
          children: [
            { children: [], id: 8, name: "å¤§è±¡", parentId: 4 },
            { children: [], id: 9, name: "æµ·è±š", parentId: 4 },
            { children: [], id: 10, name: "çŒ©çŒ©", parentId: 4 }
          ],
          id: 4,
          name: "å“ºä¹³åŠ¨ç‰©",
          parentId: 1
        },
        {
          children: [
            { children: [], id: 11, name: "èŸ’è›‡", parentId: 5 },
            { children: [], id: 12, name: "éº»é›€", parentId: 5 }
          ],
          id: 5,
          name: "åµç”ŸåŠ¨ç‰©",
          parentId: 1
        }
      ],
      id: 1,
      name: "åŠ¨ç‰©",
      parentId: 0
    },
    {
      children: [
        { children: [], id: 6, name: "ç§å­æ¤ç‰©", parentId: 2 },
        { children: [], id: 7, name: "è•¨ç±»æ¤ç‰©", parentId: 2 }
      ],
      id: 2,
      name: "æ¤ç‰©",
      parentId: 0
    },
    { children: [], id: 3, name: "å¾®ç”Ÿç‰©", parentId: 0 }
  ],
  id: 0,
  name: "ç”Ÿç‰©",
  parentId: null
};

```



2. å•å…ƒæµ‹è¯•

```ts
import arrayToTree from "./arrayToTree";
import { originData, treeData } from "./data";

test("arrayToTee", () => {
  expect(arrayToTree(originData)).toEqual(treeData);
});

```



3. å®ç°æ­¥éª¤

   + å®ç°å‡½æ•°ç­¾å

   + å®ç°å‡½æ•°ä½“

     + å¤„ç† root

     + å®ç° addChildren æ–¹æ³•

     + æ‰§è¡Œ addChildren

       

**ã€è§£é¢˜æ­¥éª¤ã€‘**

```ts
import { Item, Node } from "./data";
// + å®ç°å‡½æ•°ç­¾å
// + å®ç°å‡½æ•°ä½“
//   + å¤„ç† root
//   + å®ç° addChildren æ–¹æ³•
//   + æ‰§è¡Œ addChildren

const arrayToTree = (arr) => {
  if (!Array.isArray(arr) || arr.length < 1) return null;
  const [root] = arr.filter(item => item.parentId === null);
  const addChildren = (node, dataList) => {
    const children = dataList
      .filter(item => item.parentId === node.id)
      .map(item => addChildren(item, dataList));
    return { ...node, children };
  };
  return addChildren(root, arr);
};

export default arrayToTree;


```



## æ ‘çš„éå†

**ã€é¢˜ç›®åˆ†æã€‘**

æŠŠä¸Šä¸€èŠ‚æ ‘çš„æ•°æ®è½¬æˆæ•°ç»„ï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

1. å•å…ƒæµ‹è¯•

```ts
import treeToArray from "./treeToArray";
import { originData, treeData } from "./data";

test("arrayToTee", () => {
  expect(
    treeToArray(treeData).sort((a, b) => (a.name > b.name ? 1 : -1))
  ).toEqual(originData.sort((a, b) => (a.name > b.name ? 1 : -1)));
});
```

2. å¤§æ¦‚æ­¥éª¤

   + ç¼–å†™å‡½æ•°æ¡†æ¶
   + å®ç°  `const nodeToArray = (node: Node, result: Item[]) => {}`
   + è°ƒç”¨ nodeToArray

   

**ã€è§£é¢˜æ­¥éª¤ã€‘**

```ts
import { Node, Item } from "./data";
const treeToArray = (node: Node) => {
  const nodeToArray = (node: Node, arr: Item[]) => {
    const { children, ...item } = node;
    arr.push(item);
    children.forEach(child => nodeToArray(child, arr));
    return arr;
  };
  return nodeToArray(node, []);
};

export default treeToArray;


```



**ã€é—®é¢˜å»¶ä¼¸ã€‘**

+ äºŒå‰æ ‘éå† https://leetcode.com/problems/binary-tree-preorder-traversal/

+ äºŒå‰æ ‘å±‚åºéå† https://leetcode-cn.com/problems/binary-tree-level-order-traversal/
+ bfs 

## å¦‚ä½•é™åˆ¶æ¥å£è®¿é—®é¢‘æ¬¡

**ã€é¢˜ç›®åˆ†æã€‘**

å¦‚ä½•é™åˆ¶æ¥å£è®¿é—®é¢‘æ¬¡ï¼Ÿ

**ã€ç­”é¢˜æ€è·¯ã€‘**

æ¥å£è¯·æ±‚éƒ¨åˆ†çš„é€»è¾‘æˆ‘ä»¬å¯ä»¥å°è£…æˆä¸€ä¸ªå‡½æ•° funã€‚å‡è®¾å­˜åœ¨ä¸€ä¸ªå¤„ç†å‡½æ•°çš„å‡½æ•°betterï¼Œæ¥å—funï¼Œè¿”å›ä¸€ä¸ª betterFunã€‚å½“ betterFun è¢«å¤šæ¬¡è°ƒç”¨ï¼Œfun åªåœ¨ä¸è¦çš„æ—¶å€™æ‰§è¡Œã€‚

`const betterFun=better(fun);`



é™åˆ¶æ¥å£è®¿é—®ä¸€èˆ¬æ¶‰åŠåˆ°ç”¨æˆ·çš„è¾“å…¥ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªç»å…¸åœºæ™¯ï¼š`debounce` å¼ºåˆ¶å‡½æ•°åœ¨æŸæ®µæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡ï¼Œ`throttle` å¼ºåˆ¶å‡½æ•°ä»¥å›ºå®šçš„é€Ÿç‡æ‰§è¡Œã€‚ [å¯¹æ¯”demo](https://css-tricks.com/the-difference-between-throttling-and-debouncing/)

1. ä½¿ç”¨ debounceï¼ˆé˜²æŠ–ï¼‰  https://codepen.io/llh911001/pen/EVMLJw?editors=101
2. ä½¿ç”¨ throttle ï¼ˆæˆªæµï¼‰ https://codepen.io/llh911001/pen/XmGYKV?editors=101



debounce å•å…ƒæµ‹è¯•

```ts
import debounce from "./debounce";
jest.useFakeTimers();

test("debounce", () => {
  const func = jest.fn();
  const debounced = debounce(func, 1000);
  debounced();
  debounced();

  jest.runAllTimers();
  expect(func).toHaveBeenCalledTimes(1);
});

test("debounce twice", () => {
  const func = jest.fn();
  const debounced = debounce(func, 1000);
  debounced();
  debounced();
  setTimeout(debounced, 20);
  setTimeout(debounced, 2000);
  jest.runAllTimers();
  expect(func).toHaveBeenCalledTimes(2);
});
```



**ã€è§£é¢˜æ­¥éª¤ã€‘**

å®ç° debounce

```ts
const debounce = (fn, delay: number) => {
  let inDebounce;
  return function(...args) {
    const context = this;
    clearTimeout(inDebounce);
    inDebounce = setTimeout(() => {
      fn.apply(context, args);
    }, delay);
  };
};

export default debounce;
```



**ã€é—®é¢˜å»¶ä¼¸ã€‘**

1. å®ç° throttle

```ts
/**
*
* @param fn {Function}   å®é™…è¦æ‰§è¡Œçš„å‡½æ•°
* @param delay {Number}  æ‰§è¡Œé—´éš”ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼ˆmsï¼‰
*
* @return {Function}     è¿”å›ä¸€ä¸ªâ€œèŠ‚æµâ€å‡½æ•°
*/
function throttle(fn, threshold) {
  // è®°å½•ä¸Šæ¬¡æ‰§è¡Œçš„æ—¶é—´
  var last
  // å®šæ—¶å™¨
  var timer
  // é»˜è®¤é—´éš”ä¸º 250ms
  threshold || (threshold = 250)
  // è¿”å›çš„å‡½æ•°ï¼Œæ¯è¿‡ threshold æ¯«ç§’å°±æ‰§è¡Œä¸€æ¬¡ fn å‡½æ•°
  return function () {
    // ä¿å­˜å‡½æ•°è°ƒç”¨æ—¶çš„ä¸Šä¸‹æ–‡å’Œå‚æ•°ï¼Œä¼ é€’ç»™ fn
    var context = this
    var args = arguments
    var now = +new Date()
    // å¦‚æœè·ç¦»ä¸Šæ¬¡æ‰§è¡Œ fn å‡½æ•°çš„æ—¶é—´å°äº thresholdï¼Œé‚£ä¹ˆå°±æ”¾å¼ƒ
    // æ‰§è¡Œ fnï¼Œå¹¶é‡æ–°è®¡æ—¶
    if (last && now < last + threshold) {
      clearTimeout(timer)
      // ä¿è¯åœ¨å½“å‰æ—¶é—´åŒºé—´ç»“æŸåï¼Œå†æ‰§è¡Œä¸€æ¬¡ fn
      timer = setTimeout(function () {
        last = now
        fn.apply(context, args)
      }, threshold)
    // åœ¨æ—¶é—´åŒºé—´çš„æœ€å¼€å§‹å’Œåˆ°è¾¾æŒ‡å®šé—´éš”çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ fn
    } else {
      last = now
      fn.apply(context, args)
    }
  }
}
```



2. debounce.leading vs debounce.trailing

debounce.leading demo: https://codepen.io/dcorb/pen/GZWqNV

debounce.trailing demo: https://codepen.io/dcorb/pen/KVxGqN

```ts
function debounce(func, wait, immediate) {
	var timeout;
	return function() {
		var context = this, args = arguments;
		var later = function() {
			timeout = null;
			if (!immediate) func.apply(context, args);
		};
		var callNow = immediate && !timeout;
		clearTimeout(timeout);
		timeout = setTimeout(later, wait);
		if (callNow) func.apply(context, args);
	};
};
```



å‚è€ƒï¼š

https://css-tricks.com/the-difference-between-throttling-and-debouncing/

http://hackll.com/2015/11/19/debounce-and-throttle/index.html

https://zhuanlan.zhihu.com/p/50367441

http://demo.nimius.net/debounce_throttle/



##  å‰åç«¯è”è°ƒæ³¨æ„äº‹é¡¹

ã€é¢˜ç›®åˆ†æã€‘

ä½ ä»¬å…¬å¸ï¼ˆä¸Šä¸€å®¶å…¬å¸ï¼‰ï¼Œä¸€èˆ¬æ˜¯æ€ä¹ˆè¿›è¡Œå‰åç«¯è”è°ƒçš„ï¼Ÿ

ã€ç­”é¢˜æ€è·¯ã€‘

1. é¡¹ç›®æ˜¯å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼›åç«¯è´Ÿè´£æä¾›æ•°æ®æ¥å£ï¼Œå‰ç«¯è´Ÿè´£é¡µé¢ã€‚

2. ä¸€èˆ¬æ¥å£å®Œæˆä¹‹åï¼Œåç«¯ä¼šç»™ä¸€ä»½æ¥å£æ–‡æ¡£ï¼ŒåŒ…å«æ¥å£åœ°å€ï¼Œè¯·æ±‚ç±»å‹ï¼Œè¯·æ±‚çš„å‚æ•°ï¼Œå¯èƒ½çš„æ•°æ®è¿”å›ã€‚

3. éƒ¨åˆ†åç«¯åŒå­¦å¯èƒ½ä¸å†™æ–‡æ¡£ï¼Œä¼šè¿›è¡Œå£å¤´æ²Ÿé€šã€‚å£å¤´æ²Ÿé€šçš„æ—¶å€™éœ€è¦è®°å½•å¿…è¦çš„ä¿¡æ¯ã€‚

4. è”è°ƒçš„æ—¶å€™æœ€å¥½æ˜¯å·¥ä½œæ—¶é—´ï¼ˆå…å¾—æ™šä¸Šï¼Œåˆ«äººä¸‹ç­äº†ï¼‰ï¼Œå› ä¸ºå¯èƒ½æ¶‰åŠåˆ°æ²Ÿé€šã€‚

5. æœ€å¥½å¼€å‘ä¹‹å‰æƒ³å¥½ä½ éœ€è¦å“ªäº›æ•°æ®ï¼Œç„¶åå’Œåç«¯æå‰æ²Ÿé€šä¸€ä¸‹ã€‚é¿å…ä¸€ä¸‹ä½ éœ€è¦çš„æ•°æ®ï¼Œåç«¯æ²¡æœ‰å¼€å‘ï¼Œå¯¼è‡´é¡¹ç›®å·¥æœŸå»¶è¯¯ã€‚

   

##  å¤ä¹ jsï¼ˆå¯é€‰ï¼‰

[è®²ä¹‰](./how javascript run.md) 
